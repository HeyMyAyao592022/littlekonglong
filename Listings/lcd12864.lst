C51 COMPILER V9.60.7.0   LCD12864                                                          06/12/2023 22:14:27 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN .\Objects\lcd12864.obj
COMPILER INVOKED BY: D:\2023stuffs\Keil\C51\BIN\C51.EXE lcd12864.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\L
                    -istings\lcd12864.lst) TABS(2) OBJECT(.\Objects\lcd12864.obj)

line level    source

   1          /*
   2           * LCD128*64
   3           */
   4          
   5          #include "lcd12864.h"
   6          
   7          void chekbusy12864(void)
   8          {
   9   1        uint8 dat;
  10   1      
  11   1        RS = 0;
  12   1        RW = 1;
  13   1        do
  14   1        {
  15   2          P2 = 0;
  16   2          E = 1;
  17   2          _nop_();
  18   2          dat = P2 & 0x80;
  19   2          E = 0;
  20   2        } while (dat != 0);
  21   1      }
  22          
  23          void choose12864(uint8 i)
  24          {
  25   1        switch (i)
  26   1        {
  27   2        case 0:
  28   2          CS1 = 0;
  29   2          CS2 = 1;
  30   2          break;
  31   2        case 1:
  32   2          CS1 = 1;
  33   2          CS2 = 0;
  34   2          break;
  35   2      
  36   2        default:
  37   2          break;
  38   2        }
  39   1      }
  40          
  41          void cmd_w12864(uint8 cmd)
  42          {
  43   1        chekbusy12864();
  44   1      
  45   1        RS = 0;
  46   1        RW = 0;
  47   1        _nop_();
  48   1        E = 1;
  49   1        _nop_();
  50   1        P2 = cmd;
  51   1        _nop_();
  52   1        E = 0;
  53   1      }
  54          
C51 COMPILER V9.60.7.0   LCD12864                                                          06/12/2023 22:14:27 PAGE 2   

  55          void dat_w12864(uint8 dat)
  56          {
  57   1        chekbusy12864();
  58   1      
  59   1        RS = 1;
  60   1        RW = 0;
  61   1        _nop_();
  62   1        E = 1;
  63   1        _nop_();
  64   1        P2 = dat;
  65   1        _nop_();
  66   1        E = 0;
  67   1      }
  68          
  69          void clear12864(void)
  70          {
  71   1        uint8 page, row;
  72   1      
  73   1        // ÈÄâÊã©Â∑¶Â±è
  74   1        choose12864(0);
  75   1        // ÈÅçÂéÜ 8 È°µ
  76   1        for (page = 0; page < 8; page++)
  77   1        {
  78   2          cmd_w12864(0xb8 + page);
  79   2          cmd_w12864(0x40);
  80   2          for (row = 0; row < 64; row++)
  81   2          {
  82   3      
  83   3            dat_w12864(0x00);
  84   3          }
  85   2        }
  86   1      
  87   1        choose12864(1);
  88   1        for (page = 0; page < 8; page++)
  89   1        {
  90   2          cmd_w12864(0xb8 + page);
  91   2          cmd_w12864(0x40);
  92   2          for (row = 0; row < 64; row++)
  93   2          {
  94   3            dat_w12864(0x00);
  95   3          }
  96   2        }
  97   1      }
  98          
  99          void LCD_init(void)
 100          {
 101   1        chekbusy12864();
 102   1        cmd_w12864(0xc0);
 103   1        cmd_w12864(0x3f);
 104   1        clear12864();
 105   1      }
 106          
 107          void play8(uint8 x, uint8 y, uint8 *addr)
 108          {
 109   1        uint8 i;
 110   1      
 111   1        // x>63ÔºåËØ¥Êòé x Âú®Âè≥ËæπÔºåÈÄâÊã©Âè≥Â±è
 112   1        if (x > 63)
 113   1        {
 114   2          choose12864(1);
 115   2          x = x - 64;
 116   2        }
C51 COMPILER V9.60.7.0   LCD12864                                                          06/12/2023 22:14:27 PAGE 3   

 117   1        else
 118   1          choose12864(0);
 119   1      
 120   1        // ÂÜôÂÖ• x,y ‰ΩçÁΩÆ
 121   1        cmd_w12864(0x40 | x);
 122   1        cmd_w12864(0xb8 | (y++));
 123   1      
 124   1        // Á°Æ‰øù y Á¨¨ÂÖ´‰Ωç‰∏∫ 0
 125   1        if ((y & 0x80) == 0)
 126   1          // ÂÜôÂÖ• 8 ‰∏™ 8 ‰ΩçÁöÑ 16 ËøõÂà∂Êï∞ÊçÆ
 127   1          for (i = 0; i < 8; i++)
 128   1            dat_w12864(*addr++);
 129   1        else
 130   1          for (i = 0; i < 8; i++)
 131   1            dat_w12864(0xFF - *addr++);
 132   1      
 133   1        // ÂÜôÂÖ• x, y + 1
 134   1        cmd_w12864(0x40 | x);
 135   1        cmd_w12864(0xb8 | y);
 136   1      
 137   1        if ((y & 0x80) == 0)
 138   1          for (i = 0; i < 8; i++)
 139   1            dat_w12864(*addr++);
 140   1        else
 141   1          for (i = 0; i < 8; i++)
 142   1            dat_w12864(0xFF - *addr++);
 143   1      }
 144          
 145          void play16(uint8 x, uint8 y, uint8 *addr)
 146          {
 147   1        uint8 i;
 148   1      
 149   1        if (x > 63)
 150   1        {
 151   2          choose12864(1);
 152   2          x = x - 64;
 153   2        }
 154   1        else
 155   1          choose12864(0);
 156   1      
 157   1        cmd_w12864(0x40 | x);
 158   1        cmd_w12864(0xb8 | (y++));
 159   1      
 160   1        if ((y & 0x80) == 0)
 161   1          for (i = 0; i < 16; i++)
 162   1            dat_w12864(*addr++);
 163   1        else
 164   1          for (i = 0; i < 16; i++)
 165   1            dat_w12864(0xFF - *addr++);
 166   1      
 167   1        cmd_w12864(0x40 | x);
 168   1        cmd_w12864(0xb8 | y);
 169   1      
 170   1        if ((y & 0x80) == 0)
 171   1          for (i = 0; i < 16; i++)
 172   1            dat_w12864(*addr++);
 173   1        else
 174   1          for (i = 0; i < 16; i++)
 175   1            dat_w12864(0xFF - *addr++);
 176   1      }
 177          
 178          void drawPicture8(uint8 x, uint8 y, uint8 *addr)
C51 COMPILER V9.60.7.0   LCD12864                                                          06/12/2023 22:14:27 PAGE 4   

 179          {
 180   1        uint8 i;
 181   1      
 182   1        // x>63ÔºåËØ¥Êòé x Âú®Âè≥ËæπÔºåÈÄâÊã©Âè≥Â±è
 183   1        if (x > 63)
 184   1        {
 185   2          choose12864(1);
 186   2          x = x - 64;
 187   2        }
 188   1        else
 189   1          choose12864(0);
 190   1      
 191   1        // ÂÜôÂÖ• x,y ‰ΩçÁΩÆ
 192   1        cmd_w12864(0x40 | x);
 193   1        cmd_w12864(0xb8 | (y++));
 194   1      
 195   1        // Á°Æ‰øù y Á¨¨ÂÖ´‰Ωç‰∏∫ 0
 196   1        if ((y & 0x80) == 0)
 197   1          // ÂÜôÂÖ• 8 ‰∏™ 8 ‰ΩçÁöÑ 16 ËøõÂà∂Êï∞ÊçÆ
 198   1          for (i = 0; i < 8; i++)
 199   1            dat_w12864(*addr++);
 200   1        else
 201   1          for (i = 0; i < 8; i++)
 202   1            dat_w12864(0xFF - *addr++);
 203   1      
 204   1        // ÂÜôÂÖ• x, y + 1
 205   1        cmd_w12864(0x40 | x);
 206   1        cmd_w12864(0xb8 | y);
 207   1      
 208   1        if ((y & 0x80) == 0)
 209   1          for (i = 0; i < 8; i++)
 210   1            dat_w12864(*addr++);
 211   1        else
 212   1          for (i = 0; i < 8; i++)
 213   1            dat_w12864(0xFF - *addr++);
 214   1      }
 215          
 216          void drawPicture16(uint8 x, uint8 y, uint8 *addr)
 217          {
 218   1        uint8 i;                    // ÈÅçÂéÜ
 219   1        uint8 offset;                 // Â¶ÇÊûúÂõæÂÉèÊ®™Ë∑®Â∑¶Âè≥Â±èÂπïÔºåÂèØ‰ª•Áî®‰∫éËæÖÂä©ËÆ°ÁÆó
 220   1        uint8 *img_ptr = NULL;              // Â¶ÇÊûúÂõæÂÉèÊ®™Ë∑®Â∑¶Âè≥Â±èÂπïÔºåÂèØ‰ª•Áî® img_ptr ‰øùÂ≠ò addr ÂéüÂßãÂú∞Â
             -ùÄ
 221   1        uint8 crossScreen = (x > 47 && x < 63) ? 1 : 0; // Âà§Êñ≠ÂõæÂÉèÊòØÂê¶Ê®™Ë∑®Â∑¶Âè≥Â±èÂπï
 222   1      
 223   1        // Ê®™ÂùêÊ†áË∂ÖËøá 63ÔºåÂ∞±ÊòæÁ§∫Âà∞Âè≥ÂçäÂ±èÂπï
 224   1        if (x < 63)
 225   1          choose12864(0);
 226   1        else if (x < 112)
 227   1        {
 228   2          choose12864(1);
 229   2          x = x - 64;
 230   2        }
 231   1        else
 232   1          return;
 233   1      
 234   1        // ÂÆö‰ΩçÂà∞‰∏äÂçäÈÉ®
 235   1        cmd_w12864(0x40 | x);
 236   1        cmd_w12864(0xb8 | y);
 237   1      
 238   1        // ÂÜôÂÖ•‰∏äÂçäÈÉ®ÂàÜ
 239   1        // if Âà§Êñ≠ÊòØÂê¶Ë∑®Ë∂äÂ∑¶Âè≥ÂçäÂ±è
C51 COMPILER V9.60.7.0   LCD12864                                                          06/12/2023 22:14:27 PAGE 5   

 240   1        if (!crossScreen)
 241   1          for (i = 0; i < 16; i++)
 242   1            dat_w12864(*addr++);
 243   1        else
 244   1        {
 245   2          // Ë∑®Â±èÂπïÁöÑËØùÔºåÂ∞±ÂÖàÂÜôÂ∑¶Â±èÂπïÈÉ®ÂàÜ
 246   2          offset = 63 - x;
 247   2          // Áî® img_ptr ‰øùÂ≠ò addr ÂéüÂßãÂú∞ÂùÄ
 248   2          img_ptr = addr;
 249   2          for (i = 0; i < offset; i++)
 250   2            dat_w12864(*addr++);
 251   2          for (i = 0; i < 8 - offset; i++)
 252   2            dat_w12864(0x00);
 253   2        }
 254   1      
 255   1        // ÂÆö‰ΩçÂà∞‰∏ãÂçäÈÉ®ÂàÜ
 256   1        cmd_w12864(0x40 | x);
 257   1        cmd_w12864(0xb8 | (y + 1));
 258   1      
 259   1        // ÂÜôÂÖ•‰∏ãÂçäÈÉ®ÂàÜ
 260   1        // if Âà§Êñ≠ÊòØÂê¶Ë∑®Ë∂äÂ∑¶Âè≥ÂçäÂ±è
 261   1        if (!crossScreen)
 262   1          for (i = 0; i < 16; i++)
 263   1            dat_w12864(*addr++);
 264   1        else
 265   1        {
 266   2          // Ë∑®Â±èÂπïÁöÑËØùÔºåÂ∞±ÂÖàÂÜôÂ∑¶Â±èÂπïÈÉ®ÂàÜ
 267   2          addr = img_ptr + 8;
 268   2          for (i = 0; i < offset; i++)
 269   2            dat_w12864(*addr++);
 270   2          for (i = 0; i < 8 - offset; i++)
 271   2            dat_w12864(0x00);
 272   2        }
 273   1      
 274   1        // Â¶ÇÊûúË∑®Â∑¶Âè≥Â±èÂπïÔºåÈÇ£Â∞±ÊâßË°å‰∏ãÈù¢ÁöÑÁ®ãÂ∫è
 275   1        if (!crossScreen)
 276   1          return;
 277   1      
 278   1        // // ÂÜôÂè≥Â±èÂπïÁöÑÈÉ®ÂàÜ
 279   1        // choose12864(1);
 280   1        // x = 0;
 281   1      
 282   1        // // ÂÆö‰ΩçÂà∞‰∏äÂçäÈÉ®
 283   1        // cmd_w12864(0x40);
 284   1        // cmd_w12864(0xb8 | y);
 285   1      
 286   1        // addr = img_ptr + offset;
 287   1        // // ÂÜôÂÖ•‰∏äÂçäÈÉ®ÂàÜ
 288   1        // for (i = offset; i < 16; i++)
 289   1        //  dat_w12864(*addr++);
 290   1      
 291   1        // // ÂÆö‰ΩçÂà∞‰∏ãÂçäÈÉ®ÂàÜ
 292   1        // cmd_w12864(0x40 | x);
 293   1        // cmd_w12864(0xb8 | (y + 1));
 294   1      
 295   1        // addr = img_ptr + offset + 8;
 296   1        // // ÂÜôÂÖ•‰∏ãÂçäÈÉ®ÂàÜ
 297   1        // for (i = offset; i < 16; i++)
 298   1        //  dat_w12864(*addr++);
 299   1      }
 300          
 301          void clearObject(uint8 x, uint8 y)
C51 COMPILER V9.60.7.0   LCD12864                                                          06/12/2023 22:14:27 PAGE 6   

 302          {
 303   1        uint8 i;
 304   1      
 305   1        if (x > 63)
 306   1        {
 307   2          choose12864(1);
 308   2          x = x - 64;
 309   2        }
 310   1        else
 311   1          choose12864(0);
 312   1      
 313   1        cmd_w12864(0x40 | x);
 314   1        cmd_w12864(0xb8 | (y++));
 315   1      
 316   1        for (i = 0; i < 16; i++)
 317   1          dat_w12864(0x00);
 318   1      
 319   1        cmd_w12864(0x40 | x);
 320   1        cmd_w12864(0xb8 | y);
 321   1      
 322   1        for (i = 0; i < 16; i++)
 323   1          dat_w12864(0x00);
 324   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1038    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      21
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
