C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN .\Objects\lcd12864.obj
COMPILER INVOKED BY: D:\2023stuffs\Keil\C51\BIN\C51.EXE lcd12864.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRI
                    -NT(.\Listings\lcd12864.lst) TABS(2) OBJECT(.\Objects\lcd12864.obj)

line level    source

   1          #include "lcd12864.h"
   2          
   3          /**
   4           * @brief ÊòüÊòü
   5           *
   6           */
   7          xdata const uint8 img_star[8] =
   8            {0x1E, 0x3E, 0x7F, 0x7E,
   9             0x7E, 0x7F, 0x3E, 0x1E};
  10          
  11          /**
  12           * @brief ÂæóÂàÜ
  13           *
  14           */
  15          // xdata const uint8 img_points[8] =
  16          //  {0x00, 0x08, 0x78, 0x3E,
  17          //   0x3C, 0x78, 0x08, 0x00};
  18          
  19          /**
  20           * @brief Êï∞Â≠óÁöÑÂõæÂÉè 4*8Â§ßÂ∞è
  21           *
  22           */
  23          xdata const uint8 img_nums[10][4] = {
  24            {0x1C, 0x24, 0x22, 0x3C}, /*"0",0*/
  25            {0x00, 0x04, 0x3E, 0x00}, /*"1",0*/
  26            {0x20, 0x32, 0x32, 0x2C}, /*"2",0*/
  27            {0x00, 0x2A, 0x2A, 0x34}, /*"3",0*/
  28            {0x10, 0x18, 0x14, 0x3E}, /*"4",0*/
  29            {0x00, 0x2E, 0x2A, 0x32}, /*"5",0*/
  30            {0x18, 0x34, 0x2A, 0x3A}, /*"6",0*/
  31            {0x02, 0x22, 0x1A, 0x06}, /*"7",0*/
  32            {0x14, 0x2C, 0x2A, 0x34}, /*"8",0*/
  33            {0x0C, 0x34, 0x32, 0x3C}};
  34          
  35          /**
  36           * @brief ËæÖÂä©ÊòæÁ§∫ÊùøÂùó
  37           *
  38           */
  39          void auxDrawBlock(uint8 x, uint8 screen_y, uint8 offset_y);
  40          
  41          /**
  42           * @brief ËæÖÂä©ÊòæÁ§∫ÊÅêÈæô
  43           *
  44           * @param konglong
  45           */
  46          
  47          /**
  48           * @brief ËæÖÂä©ÊòæÁ§∫Ë∑®Ë∂äÂ∑¶Âè≥Â±èÂπïÁöÑÊÅêÈæô
  49           *
  50           */
  51          void auxDrawKonglongX(KongLong *KongLong, uint8 screen_y, uint8 offset_y);
  52          
  53          /**
  54           * @brief Ê∏ÖÈô§Â∞èÊÅêÈæô‰∏ãÈôçÁöÑÊÆãÂΩ±
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 2   

  55           *
  56           * @param x
  57           * @param screen_y
  58           */
  59          void clearGhost(uint8 x, uint8 screen_y);
  60          
  61          /**
  62           * @brief Â∞èÊùøÂùóÁöÑ‰∫åËøõÂà∂‰ª£Á†Å
  63           *
  64           */
  65          #define blockDot 0x09
  66          
  67          /**
  68           * @brief Â∞èÂà∫ÁöÑ‰∫åËøõÂà∂‰ª£Á†Å
  69           *
  70           */
  71          #define blockDotThorn1 0x0f
  72          #define blockDotThorn2 0x0e
  73          
  74          /// @brief ËæÖÂä©ÊòæÁ§∫ÂõæÁâá
  75          data uint8 segment[16];
  76          
  77          /// @brief
  78          data int8 screen_y;
  79          data int8 offset_y;
  80          
  81          void chekbusy12864(void)
  82          {
  83   1        data uint8 dat;
  84   1      
  85   1        RS = 0;
  86   1        RW = 1;
  87   1        do
  88   1        {
  89   2          P2 = 0;
  90   2          E = 1;
  91   2          _nop_();
  92   2          dat = P2 & 0x80;
  93   2          E = 0;
  94   2        } while (dat != 0);
  95   1      }
  96          
  97          void choose12864(uint8 i)
  98          {
  99   1        switch (i)
 100   1        {
 101   2        case 0:
 102   2          CS1 = 0;
 103   2          CS2 = 1;
 104   2          break;
 105   2        case 1:
 106   2          CS1 = 1;
 107   2          CS2 = 0;
 108   2          break;
 109   2      
 110   2        default:
 111   2          break;
 112   2        }
 113   1      }
 114          
 115          void cmd_w12864(uint8 cmd)
 116          {
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 3   

 117   1        chekbusy12864();
 118   1      
 119   1        RS = 0;
 120   1        RW = 0;
 121   1        _nop_();
 122   1        E = 1;
 123   1        _nop_();
 124   1        P2 = cmd;
 125   1        _nop_();
 126   1        E = 0;
 127   1      }
 128          
 129          void dat_w12864(uint8 dat)
 130          {
 131   1        chekbusy12864();
 132   1      
 133   1        RS = 1;
 134   1        RW = 0;
 135   1        _nop_();
 136   1        E = 1;
 137   1        _nop_();
 138   1        P2 = dat;
 139   1        _nop_();
 140   1        E = 0;
 141   1      }
 142          
 143          /**
 144           * @brief ËØªÂèñÂ±èÂπïÊï∞ÊçÆ
 145           *
 146           * @return uint8
 147           */
 148          uint8 dat_r12864(void)
 149          {
 150   1        data uint8 lcdData;
 151   1        chekbusy12864();
 152   1        P2 = 0xff;
 153   1        E = 0;
 154   1        RS = 1;
 155   1        RW = 1;
 156   1        E = 1;
 157   1        _nop_();
 158   1        _nop_();
 159   1        _nop_();
 160   1        lcdData = P2;
 161   1        _nop_();
 162   1        _nop_();
 163   1        _nop_();
 164   1        E = 0;
 165   1        return lcdData;
 166   1      }
 167          
 168          void clear12864(void)
 169          {
 170   1        data uint8 page, row;
 171   1      
 172   1        // ÈÄâÊã©Â∑¶Â±è
 173   1        choose12864(0);
 174   1        // ÈÅçÂéÜ 8 È°µ
 175   1        for (page = 0; page < 8; page++)
 176   1        {
 177   2          cmd_w12864(0xb8 + page);
 178   2          cmd_w12864(0x40);
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 4   

 179   2          for (row = 0; row < 64; row++)
 180   2          {
 181   3      
 182   3            dat_w12864(0x00);
 183   3          }
 184   2        }
 185   1      
 186   1        choose12864(1);
 187   1        for (page = 0; page < 8; page++)
 188   1        {
 189   2          cmd_w12864(0xb8 + page);
 190   2          cmd_w12864(0x40);
 191   2          for (row = 0; row < 64; row++)
 192   2          {
 193   3            dat_w12864(0x00);
 194   3          }
 195   2        }
 196   1      }
 197          
 198          void LCD_init(void)
 199          {
 200   1        chekbusy12864();
 201   1        cmd_w12864(0xc0);
 202   1        cmd_w12864(0x3f);
 203   1        clear12864();
 204   1      }
 205          
 206          void drawBlock(uint8 x, uint8 y, bit standing)
 207          {
 208   1        data uint8 i;
 209   1        //  data uint8 blockDot = 0x0f;
 210   1        screen_y = y / 8; // ÁÆóÂá∫ y ÂØπÂ∫îÂ±èÂπïÁöÑ y ÂùêÊ†á
 211   1        offset_y = y % 8; // ÁÆóÂá∫ y ÂØπ screen_y ÁöÑÂÅèÁßª
 212   1      
 213   1        // ÈÄâÊã©Â±èÂπï
 214   1        if (x > 63)
 215   1        {
 216   2          choose12864(1);
 217   2          x = x - 64;
 218   2        }
 219   1        else
 220   1          choose12864(0);
 221   1      
 222   1        // offset ‰∏∫ 0 Â∞±Ê≠£Â∏∏ÊòæÁ§∫ÂõæÁâá
 223   1        if (!offset_y)
 224   1        {
 225   2          cmd_w12864(0x40 | x);
 226   2          cmd_w12864(0xb8 | screen_y);
 227   2      
 228   2          dat_w12864(0x0f);
 229   2          for (i = 1; i < 15; i++)
 230   2            dat_w12864(blockDot);
 231   2          dat_w12864(0x0f);
 232   2        }
 233   1        // Âê¶ÂàôÔºå‰∏ÄÂº†ÂõæÁâáË¶ÅÊãÜÂàÜÊàê2ÊÆµ
 234   1        else
 235   1        {
 236   2          // ÂÖàÁîªÁ¨¨‰∏ÄÊÆµ
 237   2          cmd_w12864(0x40 | x);
 238   2          cmd_w12864(0xb8 | (screen_y));
 239   2      
 240   2          // Â¶ÇÊûúÊùøÂùó‰∏äÈù¢Á´ôÂú®Â∞èÊÅêÈæôÔºåÂàô‰ΩøÁî®Â§çÊùÇÁªòÂõæÊ≥ï
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 5   

 241   2          if (standing)
 242   2          {
 243   3            auxDrawBlock(x, screen_y, offset_y);
 244   3          }
 245   2          else
 246   2          {
 247   3            segment[0] = (0x0f << offset_y) | 0x00;
 248   3            dat_w12864(segment[0]);
 249   3            for (i = 1; i < 15; i++)
 250   3            {
 251   4              segment[0] = (blockDot << offset_y) | 0x00;
 252   4              dat_w12864(segment[0]);
 253   4            }
 254   3            segment[0] = (0x0f << offset_y) | 0x00;
 255   3            dat_w12864(segment[0]);
 256   3          }
 257   2      
 258   2          // ÂÜçÁîªÁ¨¨‰∫åÊÆµ
 259   2          cmd_w12864(0x40 | x);
 260   2          cmd_w12864(0xb8 | (screen_y + 1));
 261   2      
 262   2          segment[0] = (0x0f >> (8 - offset_y));
 263   2          dat_w12864(segment[0]);
 264   2          for (i = 1; i < 15; i++)
 265   2          {
 266   3            segment[0] = (blockDot >> (8 - offset_y));
 267   3            dat_w12864(segment[0]);
 268   3          }
 269   2          segment[0] = (0x0f >> (8 - offset_y));
 270   2          dat_w12864(segment[0]);
 271   2      
 272   2          segment[0] = 0x00;
 273   2        }
 274   1      }
 275          
 276          /**
 277           * @brief ÁªòÂà∂Â∞èÂà∫
 278           *
 279           * @param x
 280           * @param y
 281           */
 282          void drawThurn(uint8 x, uint8 y)
 283          {
 284   1        data uint8 i;
 285   1        data uint8 index = 0;
 286   1        screen_y = y / 8; // ÁÆóÂá∫ y ÂØπÂ∫îÂ±èÂπïÁöÑ y ÂùêÊ†á
 287   1        offset_y = y % 8; // ÁÆóÂá∫ y ÂØπ screen_y ÁöÑÂÅèÁßª
 288   1      
 289   1        // ÈÄâÊã©Â±èÂπï
 290   1        if (x > 63)
 291   1        {
 292   2          choose12864(1);
 293   2          x = x - 64;
 294   2        }
 295   1        else
 296   1          choose12864(0);
 297   1      
 298   1        if (!(y % 8))
 299   1        {
 300   2          clearLine(x, y + 1);
 301   2        }
 302   1      
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 6   

 303   1        // offset ‰∏∫ 0 Â∞±Ê≠£Â∏∏ÊòæÁ§∫ÂõæÁâá
 304   1        if (!offset_y)
 305   1        {
 306   2          cmd_w12864(0x40 | x);
 307   2          cmd_w12864(0xb8 | screen_y);
 308   2      
 309   2          dat_w12864(0x0f);
 310   2          for (i = 1; i < 15; i++)
 311   2            dat_w12864(blockDot);
 312   2          dat_w12864(0x0f);
 313   2        }
 314   1        // Âê¶ÂàôÔºå‰∏ÄÂº†ÂõæÁâáË¶ÅÊãÜÂàÜÊàê2ÊÆµ
 315   1        else
 316   1        {
 317   2          // ÂÖàÁîªÁ¨¨‰∏ÄÊÆµ
 318   2          cmd_w12864(0x40 | x);
 319   2          cmd_w12864(0xb8 | (screen_y));
 320   2      
 321   2          // Á¨¨‰∏ÄÊÆµ
 322   2          for (i = 0; i < 16; i++)
 323   2          {
 324   3            if (index++ % 2)
 325   3              segment[0] = (blockDotThorn1 << offset_y) | 0x00;
 326   3            else
 327   3              segment[0] = (blockDotThorn2 << offset_y) | 0x00;
 328   3            dat_w12864(segment[0]);
 329   3          }
 330   2      
 331   2          // ÂÜçÁîªÁ¨¨‰∫åÊÆµ
 332   2          cmd_w12864(0x40 | x);
 333   2          cmd_w12864(0xb8 | (screen_y + 1));
 334   2      
 335   2          for (i = 0; i < 16; i++)
 336   2          {
 337   3            segment[0] = (0x0f >> (8 - offset_y));
 338   3            dat_w12864(segment[0]);
 339   3          }
 340   2      
 341   2          segment[0] = 0x00;
 342   2        }
 343   1      }
 344          
 345          /**
 346           * @brief
 347           * ÂõæÂÉèÁöÑ y ÂùêÊ†áÂπ∂‰∏çÊòØÂ±èÂπïÁöÑÂÆûÈôÖ y ÂùêÊ†áÔºåÂ±èÂπïÁ∫µÊñπÂêëË¢´ÂàÜ‰∏∫‰∫Ü 8 ÊÆµÔºåÊØèÊÆµÊúâ 8 Ë
             -°åÔºåÂÖ± 64 ‰∏™ÂÉèÁ¥†„ÄÇ
 348           * Êàë‰ª¨ÊØèÊ¨°ÂêëÂ±èÂπïÂÜôÂÖ•‰∏Ä‰∏™ 8‰Ωç16ËøõÂà∂Êï∞ÊçÆÔºåÈÇ£Ëøô‰∏™Êï∞ÊçÆÂ∞±‰ºöÂú®Â±èÂπï‰∏äÂΩ¢Êàê Á∫µÊñπÂê
             -ëÁöÑ8‰∏™Â∞èÁÇπ„ÄÇÔºàÂàöÂ•ΩÊòØ 16x16 ÂõæÂÉèÈ´òÂ∫¶ÁöÑ‰∏ÄÂçäÔºâ
 349           * ‰∏ÄËà¨Êàë‰ª¨Ë¶ÅÂú® Ôºàscreen_x,screen_y) ÁöÑÂú∞ÊñπÂÜôÂÖ• 16x16 ÁöÑÂõæÁâáÔºå
 350           * ÈÉΩÊòØÂÖàÂú® (screen_x,screen_y)ÂÜô‰∏äÂçäÈÉ®ÂàÜÔºåÂÜôÂÖ• 8 ‰∏™8‰Ωç16ËøõÂà∂Êï∞ÊçÆÔºåÊûÑÊàêÂõæÂÉèÁöÑ‰∏äÂç
             -äÈÉ®ÂàÜÔºå
 351           * ÁÑ∂ÂêéÂÜçÂú® (screen_x,screen_y + 1)ÂÜôÂÖ•‰∏ãÂçäÈÉ®ÂàÜ„ÄÇ
 352           * ÂÅáÂ¶ÇÂõæÂÉèÁöÑ y ÂùêÊ†áÂàöÂ•ΩÊòØ 8 ÁöÑÂÄçÊï∞ÔºåÊØîÂ¶Ç 16ÔºåÈÇ£ 16x16 ÁöÑÂõæÂÉèÂàöÂ•ΩÂèØ‰ª•Ë¢´ÊîæÂú®Â±è
             -Âπï y ÂùêÊ†á‰∏∫ 2 ÁöÑ‰ΩçÁΩÆ„ÄÇ
 353           * Â¶ÇÊûúÂõæÂÉèÁöÑ y ÂùêÊ†á‰∏çÊòØ 8 ÁöÑÂÄçÊï∞ÔºåÊØîÂ¶Ç 18ÔºåÈÇ£Êàë‰ª¨Â∞±ÈúÄË¶ÅÊääÂõæÂÉèÂàÜÊàê 3 ÊÆµÔºåÂπ∂È
             -ÄöËøáË¥üË¥£ÁöÑËøêÁÆóÊääÂõæÂÉèÊîæÂà∞Â±èÂπï‰∏ä„ÄÇ
 354           *
 355           */
 356          void drawKonglong(KongLong *konglong)
 357          {
 358   1        data uint8 i;
 359   1        data int8 x = konglong->x;
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 7   

 360   1        screen_y = konglong->y / 8; // ÁÆóÂá∫ y ÂØπÂ∫îÂ±èÂπïÁöÑ y ÂùêÊ†á
 361   1        offset_y = konglong->y % 8; // ÁÆóÂá∫ y ÂØπ screen_y ÁöÑÂÅèÁßª
 362   1      
 363   1        // Âà§Êñ≠ÊòØÂê¶Âú®Ë∑®Ë∂äÂ∑¶Âè≥Â±èÂπï
 364   1        if (konglong->x > 47 && konglong->x < 64)
 365   1        {
 366   2          auxDrawKonglongX(konglong, screen_y, offset_y);
 367   2          return;
 368   2        }
 369   1      
 370   1        // ÈÄâÊã©Â±èÂπï
 371   1        if (x > 63)
 372   1        {
 373   2          choose12864(1);
 374   2          x = x - 64;
 375   2        }
 376   1        else
 377   1          choose12864(0);
 378   1      
 379   1        // Ê∏ÖÈô§ÊÆãÂΩ±
 380   1        if (!((konglong->y - 1) % 8))
 381   1          clearGhost(konglong->x, screen_y - 1);
 382   1      
 383   1        // offset ‰∏∫ 0 Â∞±Ê≠£Â∏∏ÊòæÁ§∫ÂõæÁâá
 384   1        if (!offset_y)
 385   1        {
 386   2          // ÂêëÂè≥ÁßªÂä®ÂíåÂêëÂ∑¶ÁßªÂä®‰∏çÂêå
 387   2          if (konglong->towards == DIR_RIGHT)
 388   2          {
 389   3            // ‰∏äÂçäÈÉ®ÂàÜ
 390   3            cmd_w12864(0x40 | x);
 391   3            cmd_w12864(0xb8 | screen_y);
 392   3            for (i = 0; i < 16; i++)
 393   3              dat_w12864(konglong->image[i]);
 394   3      
 395   3            // ‰∏ãÂçäÈÉ®ÂàÜ
 396   3            cmd_w12864(0x40 | x);
 397   3            cmd_w12864(0xb8 | (screen_y + 1));
 398   3            for (i = 0; i < 16; i++)
 399   3              dat_w12864(konglong->image[i + 16]);
 400   3          }
 401   2          else
 402   2          {
 403   3            cmd_w12864(0x40 | x);
 404   3            cmd_w12864(0xb8 | screen_y);
 405   3            for (i = 0; i < 16; i++)
 406   3              dat_w12864(konglong->image[15 - i]);
 407   3      
 408   3            // ‰∏ãÂçäÈÉ®ÂàÜ
 409   3            // Â§ÑÁêÜË∑®Â±è
 410   3            cmd_w12864(0x40 | x);
 411   3            cmd_w12864(0xb8 | (screen_y + 1));
 412   3            // ÂêëÂè≥ÁßªÂä®ÂíåÂêëÂ∑¶ÁßªÂä®‰∏çÂêå
 413   3            for (i = 0; i < 16; i++)
 414   3              dat_w12864(konglong->image[31 - i]);
 415   3          }
 416   2        }
 417   1        // Âê¶ÂàôÔºå‰∏ÄÂº†ÂõæÁâáË¶ÅÊãÜÂàÜÊàê3ÊÆµ
 418   1        else
 419   1        {
 420   2          if (konglong->towards == DIR_RIGHT)
 421   2          {
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 8   

 422   3            // ÂÖàÁîªÁ¨¨‰∏ÄÊÆµ
 423   3            cmd_w12864(0x40 | x);
 424   3            cmd_w12864(0xb8 | screen_y);
 425   3      
 426   3            for (i = 0; i < 16; i++)
 427   3            {
 428   4              segment[0] = 0x00 | (konglong->image[i] << offset_y);
 429   4              dat_w12864(segment[0]);
 430   4            }
 431   3      
 432   3            // Á¨¨‰∫åÊÆµ
 433   3            cmd_w12864(0x40 | x);
 434   3            cmd_w12864(0xb8 | (screen_y + 1));
 435   3      
 436   3            for (i = 0; i < 16; i++)
 437   3            {
 438   4              segment[0] = (konglong->image[i] >> (8 - offset_y)) | (konglong->image[i + 16] << offset_y);
 439   4              dat_w12864(segment[0]);
 440   4            }
 441   3      
 442   3            // Á¨¨‰∏âÊÆµ
 443   3            cmd_w12864(0x40 | x);
 444   3            cmd_w12864(0xb8 | (screen_y + 2));
 445   3      
 446   3            for (i = 0; i < 16; i++)
 447   3            {
 448   4              segment[0] = konglong->image[i + 16] >> (8 - offset_y);
 449   4              dat_w12864(segment[0]);
 450   4            }
 451   3          }
 452   2          else
 453   2          {
 454   3            // ÂÖàÁîªÁ¨¨‰∏ÄÊÆµ
 455   3            cmd_w12864(0x40 | x);
 456   3            cmd_w12864(0xb8 | screen_y);
 457   3            for (i = 0; i < 16; i++)
 458   3            {
 459   4              segment[0] = 0x00 | (konglong->image[15 - i] << offset_y);
 460   4              dat_w12864(segment[0]);
 461   4            }
 462   3      
 463   3            // Á¨¨‰∫åÊÆµ
 464   3            cmd_w12864(0x40 | x);
 465   3            cmd_w12864(0xb8 | (screen_y + 1));
 466   3            for (i = 0; i < 16; i++)
 467   3            {
 468   4              segment[0] = (konglong->image[15 - i] >> (8 - offset_y)) |
 469   4                     (konglong->image[31 - i] << offset_y);
 470   4              dat_w12864(segment[0]);
 471   4            }
 472   3      
 473   3            // Á¨¨‰∏âÊÆµ
 474   3            cmd_w12864(0x40 | x);
 475   3            cmd_w12864(0xb8 | (screen_y + 2));
 476   3            for (i = 0; i < 16; i++)
 477   3            {
 478   4              segment[0] = konglong->image[31 - i] >> (8 - offset_y);
 479   4              dat_w12864(segment[0]);
 480   4            }
 481   3          }
 482   2      
 483   2          // Ê∏ÖÈô§ segment
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 9   

 484   2          segment[0] = 0x00;
 485   2          if (konglong->standingBlock != -1)
 486   2          {
 487   3            for (i = 1; i < 16; i++)
 488   3            {
 489   4              segment[i] = 0x00;
 490   4            }
 491   3          }
 492   2        }
 493   1      }
 494          
 495          void clearObject(uint8 x, uint8 y)
 496          {
 497   1        data uint8 i;
 498   1        screen_y = y / 8;   // ÁÆóÂá∫ y ÂØπÂ∫îÂ±èÂπïÁöÑ y ÂùêÊ†á
 499   1        offset_y = 8 - (y % 8); // ÁÆóÂá∫ y ÂØπ screen_y ÁöÑÂÅèÁßª
 500   1      
 501   1        if (x > 63)
 502   1        {
 503   2          choose12864(1);
 504   2          x = x - 64;
 505   2        }
 506   1        else
 507   1          choose12864(0);
 508   1      
 509   1        // offset ‰∏∫ 0 Â∞±Ê≠£Â∏∏Ê∏ÖÈô§ÂõæÁâá
 510   1        if (!offset_y)
 511   1        {
 512   2          cmd_w12864(0x40 | x);
 513   2          cmd_w12864(0xb8 | screen_y);
 514   2          for (i = 0; i < 16; i++)
 515   2            dat_w12864(0x00);
 516   2      
 517   2          // ‰∏ãÂçäÈÉ®ÂàÜ
 518   2          cmd_w12864(0x40 | x);
 519   2          cmd_w12864(0xb8 | (screen_y + 1));
 520   2          for (i = 0; i < 16; i++)
 521   2            dat_w12864(0x00);
 522   2        }
 523   1        else
 524   1        {
 525   2          cmd_w12864(0x40 | x);
 526   2          cmd_w12864(0xb8 | (screen_y));
 527   2          for (i = 0; i < 16; i++)
 528   2            dat_w12864(0x00);
 529   2      
 530   2          cmd_w12864(0x40 | x);
 531   2          cmd_w12864(0xb8 | (screen_y + 1));
 532   2          for (i = 0; i < 16; i++)
 533   2            dat_w12864(0x00);
 534   2      
 535   2          cmd_w12864(0x40 | x);
 536   2          cmd_w12864(0xb8 | (screen_y + 2));
 537   2          for (i = 0; i < 16; i++)
 538   2            dat_w12864(0x00);
 539   2        }
 540   1      }
 541          
 542          void drawRoof()
 543          {
 544   1        data uint8 i;
 545   1        choose12864(0);
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 10  

 546   1        for (i = 0; i < 64; i++)
 547   1        {
 548   2          cmd_w12864(0x40 | i);
 549   2          cmd_w12864(0xb8);
 550   2          dat_w12864(0x01);
 551   2        }
 552   1        for (i = 0; i < 8; i++)
 553   1        {
 554   2          cmd_w12864(0x40);
 555   2          cmd_w12864(0xb8 | i);
 556   2          dat_w12864(0xff);
 557   2        }
 558   1        // Âè≥
 559   1        choose12864(1);
 560   1        for (i = 0; i < 64; i++)
 561   1        {
 562   2          cmd_w12864(0x40 | i);
 563   2          cmd_w12864(0xb8);
 564   2          dat_w12864(0x01);
 565   2        }
 566   1        for (i = 0; i < 8; i++)
 567   1        {
 568   2          cmd_w12864(0x40 | 63);
 569   2          cmd_w12864(0xb8 | i);
 570   2          dat_w12864(0xff);
 571   2        }
 572   1      }
 573          
 574          /**
 575           * @brief Áî®Â§çÊùÇÁªòÂõæÊ≥ïÁîªÁ¨¨‰∏ÄÊÆµ
 576           *
 577           * @param x
 578           * @param screen_y
 579           * @param offset_y
 580           */
 581          void auxDrawBlock(uint8 x, uint8 screen_y, uint8 offset_y)
 582          {
 583   1        uint8 i;
 584   1      
 585   1        // Êåá‰ª§Â∑≤ÁªèÂú®Ë∞ÉÁî®ËØ•ÂáΩÊï∞ÂâçÂÜôÂÖ•‰∫Ü
 586   1        // ÁîªÁ¨¨‰∏ÄÊÆµ
 587   1        // Â¶ÇÊûúÂ∞èÊÅêÈæôÁ´ôÂú®Â∞èÊùøÂ≠ê‰∏äÈù¢ÔºåÊàñËÄÖÂ∞èÊùøÂ≠êËææÂà∞‰∫ÜÈ°∂Â±ÇÔºåÈÇ£Â∞±Áî®Â§çÊùÇÁªòÂà∂Ê≥ï
 588   1        dat_r12864();
 589   1        segment[0] = (0x0f << offset_y) | dat_r12864();
 590   1        for (i = 1; i < 15; i++)
 591   1        {
 592   2          dat_r12864();
 593   2          segment[i] = (blockDot << offset_y) |
 594   2                 dat_r12864() & (0xff >> (8 - offset_y));
 595   2        }
 596   1        dat_r12864();
 597   1        segment[15] = (0x0f << offset_y) | dat_r12864();
 598   1      
 599   1        cmd_w12864(0x40 | x);
 600   1        cmd_w12864(0xb8 | (screen_y));
 601   1        for (i = 0; i < 16; i++)
 602   1        {
 603   2          dat_w12864(segment[i]);
 604   2        }
 605   1      }
 606          
 607          /**
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 11  

 608           * @brief Áî®Â§çÊùÇÁªòÂõæÊ≥ïÁîªÁ¨¨‰∏âÊÆµ
 609           *
 610           * @param konglong
 611           * @param x
 612           * @param screen_y
 613           * @param offset_y
 614           */
 615          // void auxDrawKonglong(KongLong *konglong, uint8 x, uint8 screen_y, uint8 offset_y)
 616          // {
 617          //  uint8 i;
 618          
 619          //  // Êåá‰ª§Â∑≤ÁªèÂú®Ë∞ÉÁî®ËØ•ÂáΩÊï∞ÂâçÂÜôÂÖ•‰∫Ü
 620          //  for (i = 0; i < 16; i++)
 621          //  {
 622          //    dat_r12864();
 623          //    segment[i] = konglong->image[i + 16] >> (8 - offset_y) | dat_r12864();
 624          //  }
 625          
 626          //  cmd_w12864(0x40 | x);
 627          //  cmd_w12864(0xb8 | (screen_y + 2));
 628          
 629          //  if (konglong->towards == DIR_RIGHT)
 630          //  {
 631          //    for (i = 0; i < 16; i++)
 632          //    {
 633          //      dat_w12864(segment[i]);
 634          //    }
 635          //  }
 636          //  else
 637          //  {
 638          //    for (i = 0; i < 16; i++)
 639          //    {
 640          //      dat_w12864(segment[15 - i]);
 641          //    }
 642          //  }
 643          // }
 644          
 645          /**
 646           * @brief Ê®™Ë∑®Â∑¶Âè≥Â±èÂπïÁöÑÁîªÊ≥ï
 647           *
 648           * @param konglong
 649           * @param screen_y
 650           * @param offset_y
 651           */
 652          void auxDrawKonglongX(KongLong *konglong, uint8 screen_y, uint8 offset_y)
 653          {
 654   1        uint8 i;
 655   1        uint8 offset_x = 63 - konglong->x;
 656   1        // offset ‰∏∫ 0 Â∞±Ê≠£Â∏∏ÊòæÁ§∫ÂõæÁâá
 657   1        if (!offset_y)
 658   1        {
 659   2          /// @note ÂÖàÁîªÂ∑¶Ëæπ
 660   2          // ÂêëÂè≥ÁßªÂä®ÂíåÂêëÂ∑¶ÁßªÂä®‰∏çÂêå
 661   2          if (konglong->towards == DIR_RIGHT)
 662   2          {
 663   3            // ‰∏äÂçäÈÉ®ÂàÜ
 664   3            cmd_w12864(0x40 | konglong->x);
 665   3            cmd_w12864(0xb8 | screen_y);
 666   3            for (i = 0; i < offset_x; i++)
 667   3              dat_w12864(konglong->image[i]);
 668   3      
 669   3            // ‰∏ãÂçäÈÉ®ÂàÜ
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 12  

 670   3            cmd_w12864(0x40 | konglong->x);
 671   3            cmd_w12864(0xb8 | (screen_y + 1));
 672   3            for (i = 0; i < offset_x; i++)
 673   3              dat_w12864(konglong->image[i + 16]);
 674   3          }
 675   2          else
 676   2          {
 677   3            cmd_w12864(0x40 | konglong->x);
 678   3            cmd_w12864(0xb8 | screen_y);
 679   3            for (i = 0; i < offset_x; i++)
 680   3              dat_w12864(konglong->image[15 - i]);
 681   3      
 682   3            // ‰∏ãÂçäÈÉ®ÂàÜ
 683   3            // Â§ÑÁêÜË∑®Â±è
 684   3            cmd_w12864(0x40 | konglong->x);
 685   3            cmd_w12864(0xb8 | (screen_y + 1));
 686   3            // ÂêëÂè≥ÁßªÂä®ÂíåÂêëÂ∑¶ÁßªÂä®‰∏çÂêå
 687   3            for (i = 0; i < offset_x; i++)
 688   3              dat_w12864(konglong->image[31 - i]);
 689   3          }
 690   2      
 691   2          /// @note ÂÜçÁîªÂè≥Ëæπ
 692   2          choose12864(1);
 693   2      
 694   2          // ÂêëÂè≥ÁßªÂä®ÂíåÂêëÂ∑¶ÁßªÂä®‰∏çÂêå
 695   2          if (konglong->towards == DIR_RIGHT)
 696   2          {
 697   3            // ‰∏äÂçäÈÉ®ÂàÜ
 698   3            cmd_w12864(0x40);
 699   3            cmd_w12864(0xb8 | screen_y);
 700   3            for (i = offset_x; i < 16; i++)
 701   3              dat_w12864(konglong->image[i]);
 702   3      
 703   3            // ‰∏ãÂçäÈÉ®ÂàÜ
 704   3            cmd_w12864(0x40);
 705   3            cmd_w12864(0xb8 | (screen_y + 1));
 706   3            for (i = offset_x; i < 16; i++)
 707   3              dat_w12864(konglong->image[i + 16]);
 708   3          }
 709   2          else
 710   2          {
 711   3            cmd_w12864(0x40);
 712   3            cmd_w12864(0xb8 | screen_y);
 713   3            for (i = offset_x; i < 16; i++)
 714   3              dat_w12864(konglong->image[15 - i]);
 715   3      
 716   3            // ‰∏ãÂçäÈÉ®ÂàÜ
 717   3            // Â§ÑÁêÜË∑®Â±è
 718   3            cmd_w12864(0x40);
 719   3            cmd_w12864(0xb8 | (screen_y + 1));
 720   3            // ÂêëÂè≥ÁßªÂä®ÂíåÂêëÂ∑¶ÁßªÂä®‰∏çÂêå
 721   3            for (i = offset_x; i < 16; i++)
 722   3              dat_w12864(konglong->image[31 - i]);
 723   3          }
 724   2        }
 725   1        // Âê¶ÂàôÔºå‰∏ÄÂº†ÂõæÁâáË¶ÅÊãÜÂàÜÊàê3ÊÆµ
 726   1        else
 727   1        {
 728   2          /// @note ÂÖàÁîªÂ∑¶Ëæπ
 729   2          choose12864(0);
 730   2      
 731   2          if (konglong->towards == DIR_RIGHT)
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 13  

 732   2          {
 733   3            // ÂÖàÁîªÁ¨¨‰∏ÄÊÆµ
 734   3            cmd_w12864(0x40 | konglong->x);
 735   3            cmd_w12864(0xb8 | screen_y);
 736   3      
 737   3            for (i = 0; i < offset_x; i++)
 738   3            {
 739   4              segment[0] = 0x00 | (konglong->image[i] << offset_y);
 740   4              dat_w12864(segment[0]);
 741   4            }
 742   3      
 743   3            // Á¨¨‰∫åÊÆµ
 744   3            cmd_w12864(0x40 | konglong->x);
 745   3            cmd_w12864(0xb8 | (screen_y + 1));
 746   3      
 747   3            for (i = 0; i < offset_x; i++)
 748   3            {
 749   4              segment[0] = (konglong->image[i] >> (8 - offset_y)) | (konglong->image[i + 16] << offset_y);
 750   4              dat_w12864(segment[0]);
 751   4            }
 752   3      
 753   3            // Á¨¨‰∏âÊÆµ
 754   3            cmd_w12864(0x40 | konglong->x);
 755   3            cmd_w12864(0xb8 | (screen_y + 2));
 756   3      
 757   3            for (i = 0; i < offset_x; i++)
 758   3            {
 759   4              segment[0] = konglong->image[i + 16] >> (8 - offset_y);
 760   4              dat_w12864(segment[0]);
 761   4            }
 762   3          }
 763   2          else
 764   2          {
 765   3            // ÂÖàÁîªÁ¨¨‰∏ÄÊÆµ
 766   3            cmd_w12864(0x40 | konglong->x);
 767   3            cmd_w12864(0xb8 | screen_y);
 768   3            for (i = 0; i < offset_x; i++)
 769   3            {
 770   4              segment[0] = 0x00 | (konglong->image[15 - i] << offset_y);
 771   4              dat_w12864(segment[0]);
 772   4            }
 773   3      
 774   3            // Á¨¨‰∫åÊÆµ
 775   3            cmd_w12864(0x40 | konglong->x);
 776   3            cmd_w12864(0xb8 | (screen_y + 1));
 777   3            for (i = 0; i < offset_x; i++)
 778   3            {
 779   4              segment[0] = (konglong->image[15 - i] >> (8 - offset_y)) |
 780   4                     (konglong->image[31 - i] << offset_y);
 781   4              dat_w12864(segment[0]);
 782   4            }
 783   3      
 784   3            // Á¨¨‰∏âÊÆµ
 785   3            cmd_w12864(0x40 | konglong->x);
 786   3            cmd_w12864(0xb8 | (screen_y + 2));
 787   3            for (i = 0; i < offset_x; i++)
 788   3            {
 789   4              segment[0] = konglong->image[31 - i] >> (8 - offset_y);
 790   4              dat_w12864(segment[0]);
 791   4            }
 792   3          }
 793   2      
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 14  

 794   2          /// @brief ÂÜçÁîªÂè≥Ëæπ
 795   2          choose12864(1);
 796   2      
 797   2          if (konglong->towards == DIR_RIGHT)
 798   2          {
 799   3            // ÂÖàÁîªÁ¨¨‰∏ÄÊÆµ
 800   3            cmd_w12864(0x40);
 801   3            cmd_w12864(0xb8 | screen_y);
 802   3      
 803   3            for (i = offset_x; i < 16; i++)
 804   3            {
 805   4              segment[0] = 0x00 | (konglong->image[i] << offset_y);
 806   4              dat_w12864(segment[0]);
 807   4            }
 808   3      
 809   3            // Á¨¨‰∫åÊÆµ
 810   3            cmd_w12864(0x40);
 811   3            cmd_w12864(0xb8 | (screen_y + 1));
 812   3      
 813   3            for (i = offset_x; i < 16; i++)
 814   3            {
 815   4              segment[0] = (konglong->image[i] >> (8 - offset_y)) | (konglong->image[i + 16] << offset_y);
 816   4              dat_w12864(segment[0]);
 817   4            }
 818   3      
 819   3            // Á¨¨‰∏âÊÆµ
 820   3            cmd_w12864(0x40);
 821   3            cmd_w12864(0xb8 | (screen_y + 2));
 822   3      
 823   3            for (i = offset_x; i < 16; i++)
 824   3            {
 825   4              segment[0] = konglong->image[i + 16] >> (8 - offset_y);
 826   4              dat_w12864(segment[0]);
 827   4            }
 828   3          }
 829   2          else
 830   2          {
 831   3            // ÂÖàÁîªÁ¨¨‰∏ÄÊÆµ
 832   3            cmd_w12864(0x40);
 833   3            cmd_w12864(0xb8 | screen_y);
 834   3            for (i = offset_x; i < 16; i++)
 835   3            {
 836   4              segment[0] = 0x00 | (konglong->image[15 - i] << offset_y);
 837   4              dat_w12864(segment[0]);
 838   4            }
 839   3      
 840   3            // Á¨¨‰∫åÊÆµ
 841   3            cmd_w12864(0x40);
 842   3            cmd_w12864(0xb8 | (screen_y + 1));
 843   3            for (i = offset_x; i < 16; i++)
 844   3            {
 845   4              segment[0] = (konglong->image[15 - i] >> (8 - offset_y)) |
 846   4                     (konglong->image[31 - i] << offset_y);
 847   4              dat_w12864(segment[0]);
 848   4            }
 849   3      
 850   3            // Á¨¨‰∏âÊÆµ
 851   3            cmd_w12864(0x40);
 852   3            cmd_w12864(0xb8 | (screen_y + 2));
 853   3            for (i = offset_x; i < 16; i++)
 854   3            {
 855   4              segment[0] = konglong->image[31 - i] >> (8 - offset_y);
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 15  

 856   4              dat_w12864(segment[0]);
 857   4            }
 858   3          }
 859   2      
 860   2          // Ê∏ÖÈô§ segment
 861   2          segment[0] = 0x00;
 862   2          if (konglong->standingBlock != -1)
 863   2          {
 864   3            for (i = 1; i < 16; i++)
 865   3            {
 866   4              segment[i] = 0x00;
 867   4            }
 868   3          }
 869   2        }
 870   1      }
 871          
 872          /**
 873           * @brief Ê∏ÖÈô§Â∞èÊÅêÈæô‰∏ãÈôçÊó∂‰∫ßÁîüÁöÑÊÆãÂΩ±
 874           *
 875           */
 876          void clearGhost(uint8 x, uint8 screen_y)
 877          {
 878   1        uint8 i;
 879   1        cmd_w12864(0x40 | x);
 880   1        cmd_w12864(0xb8 | (screen_y));
 881   1        for (i = 0; i < 16; i++)
 882   1        {
 883   2          dat_w12864(0x00);
 884   2        }
 885   1      }
 886          
 887          /**
 888           * @brief Ê∏ÖÈô§‰∏ÄÊù°ÁóïËøπ
 889           *
 890           * @param x
 891           * @param y
 892           */
 893          void clearLine(uint8 x, uint8 y)
 894          {
 895   1        if (x > 63)
 896   1        {
 897   2          x -= 64;
 898   2          choose12864(1);
 899   2        }
 900   1        else
 901   1          choose12864(0);
 902   1      
 903   1        cmd_w12864(0x40 | x);
 904   1        cmd_w12864(0xb8 | y / 8);
 905   1        dat_w12864(0x00);
 906   1      }
 907          
 908          /**
 909           * @brief ÊòæÁ§∫Ë°®Áõò
 910           *
 911           */
 912          void drawPanel()
 913          {
 914   1        uint8 i;
 915   1        choose12864(1);
 916   1        // ÁîªÊòüÊòü
 917   1        cmd_w12864(0x40 | 38);
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 16  

 918   1        cmd_w12864(0xb8 | 1);
 919   1        for (i = 0; i < 8; ++i)
 920   1        {
 921   2          dat_w12864(img_star[i]);
 922   2        }
 923   1      }
 924          
 925          /**
 926           * @brief ÊòæÁ§∫ÂàÜÊï∞
 927           *
 928           * @param score
 929           */
 930          void updateScores(uint8 score)
 931          {
 932   1        uint8 digit;
 933   1        uint8 i;
 934   1      
 935   1        choose12864(1);
 936   1      
 937   1        digit = score % 10;
 938   1        cmd_w12864(0x40 | 54);
 939   1        cmd_w12864(0xb8 | 1);
 940   1        for (i = 0; i < 4; i++)
 941   1        {
 942   2          dat_w12864(img_nums[digit][i]);
 943   2        }
 944   1      
 945   1        digit = score / 10;
 946   1        cmd_w12864(0x40 | 46);
 947   1        cmd_w12864(0xb8 | 1);
 948   1        for (i = 0; i < 4; i++)
 949   1        {
 950   2          dat_w12864(img_nums[digit][i]);
 951   2        }
 952   1      }
 953          
 954          /**
 955           * @brief 8*16 Â§ßÂ∞èÂ≠óÁ¨¶
 956           *
 957           * @param x
 958           * @param y
 959           * @param addr
 960           */
 961          void play8(uint8 x, uint8 y, uint8 *addr)
 962          {
 963   1        uint8 i;
 964   1      
 965   1        // x>63ÔºåËØ¥Êòé x Âú®Âè≥ËæπÔºåÈÄâÊã©Âè≥Â±è
 966   1        if (x > 63)
 967   1        {
 968   2          choose12864(1);
 969   2          x = x - 64;
 970   2        }
 971   1        else
 972   1          choose12864(0);
 973   1      
 974   1        // ÂÜôÂÖ• x,y ‰ΩçÁΩÆ
 975   1        cmd_w12864(0x40 | x);
 976   1        cmd_w12864(0xb8 | y);
 977   1      
 978   1        // ÂÜôÂÖ• 8 ‰∏™ 8 ‰ΩçÁöÑ 16 ËøõÂà∂Êï∞ÊçÆ
 979   1        for (i = 0; i < 8; i++)
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 17  

 980   1          dat_w12864(*addr++);
 981   1      }
 982          
 983          /**
 984           * @brief 16*16Â§ßÂ∞èÂ≠óÁ¨¶
 985           *
 986           * @param x
 987           * @param y
 988           * @param addr
 989           */
 990          void play16(uint8 x, uint8 y, uint8 *addr)
 991          {
 992   1        uint8 i;
 993   1      
 994   1        if (x > 63)
 995   1        {
 996   2          choose12864(1);
 997   2          x = x - 64;
 998   2        }
 999   1        else
1000   1          choose12864(0);
1001   1      
1002   1        cmd_w12864(0x40 | x);
1003   1        cmd_w12864(0xb8 | y);
1004   1        for (i = 0; i < 16; i++)
1005   1          dat_w12864(*addr++);
1006   1      
1007   1        cmd_w12864(0x40 | x);
1008   1        cmd_w12864(0xb8 | (y + 1));
1009   1        for (i = 0; i < 16; i++)
1010   1          dat_w12864(*addr++);
1011   1      }
1012          
1013          /**
1014           * @brief Â±ïÁ§∫ 32*32 Â§ßÂ∞èÁöÑÂõæÁâá
1015           *
1016           * @param x
1017           * @param y
1018           * @param addr
1019           */
1020          void play32(uint8 x, uint8 y, uint8 *addr)
1021          {
1022   1        uint8 i;
1023   1      
1024   1        if (x > 63)
1025   1        {
1026   2          choose12864(1);
1027   2          x = x - 64;
1028   2        }
1029   1        else
1030   1          choose12864(0);
1031   1      
1032   1        cmd_w12864(0x40 | x);
1033   1        cmd_w12864(0xb8 | y);
1034   1        for (i = 0; i < 32; i++)
1035   1          dat_w12864(*addr++);
1036   1      
1037   1        cmd_w12864(0x40 | x);
1038   1        cmd_w12864(0xb8 | (y + 1));
1039   1        for (i = 0; i < 32; i++)
1040   1          dat_w12864(*addr++);
1041   1      
C51 COMPILER V9.60.7.0   LCD12864                                                          06/17/2023 21:54:59 PAGE 18  

1042   1        cmd_w12864(0x40 | x);
1043   1        cmd_w12864(0xb8 | (y + 2));
1044   1        for (i = 0; i < 32; i++)
1045   1          dat_w12864(*addr++);
1046   1      
1047   1        cmd_w12864(0x40 | x);
1048   1        cmd_w12864(0xb8 | (y + 3));
1049   1        for (i = 0; i < 32; i++)
1050   1          dat_w12864(*addr++);
1051   1      }
1052          
1053          /**
1054           * @brief ÁîªÈªëËâ≤
1055           *
1056           * @param x
1057           * @param y
1058           */
1059          void drawDark(uint8 x, uint8 y)
1060          {
1061   1        uint8 i;
1062   1      
1063   1        if (x > 63)
1064   1        {
1065   2          choose12864(1);
1066   2          x = x - 64;
1067   2        }
1068   1        else
1069   1          choose12864(0);
1070   1      
1071   1        cmd_w12864(0x40 | x);
1072   1        cmd_w12864(0xb8 | y);
1073   1        dat_w12864(0xff);
1074   1      }
*** WARNING C280 IN LINE 1061 OF lcd12864.c: 'i': unreferenced local variable


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4905    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     48      22
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
