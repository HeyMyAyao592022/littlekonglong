C51 COMPILER V9.60.7.0   LCD12864                                                          06/13/2023 09:48:00 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN .\Objects\lcd12864.obj
COMPILER INVOKED BY: D:\2023stuffs\Keil\C51\BIN\C51.EXE lcd12864.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\L
                    -istings\lcd12864.lst) TABS(2) OBJECT(.\Objects\lcd12864.obj)

line level    source

   1          /*
   2           * LCD128*64
   3           */
   4          
   5          #include "lcd12864.h"
   6          
   7          void chekbusy12864(void)
   8          {
   9   1        uint8 dat;
  10   1      
  11   1        RS = 0;
  12   1        RW = 1;
  13   1        do
  14   1        {
  15   2          P2 = 0;
  16   2          E = 1;
  17   2          _nop_();
  18   2          dat = P2 & 0x80;
  19   2          E = 0;
  20   2        } while (dat != 0);
  21   1      }
  22          
  23          void choose12864(uint8 i)
  24          {
  25   1        switch (i)
  26   1        {
  27   2        case 0:
  28   2          CS1 = 0;
  29   2          CS2 = 1;
  30   2          break;
  31   2        case 1:
  32   2          CS1 = 1;
  33   2          CS2 = 0;
  34   2          break;
  35   2      
  36   2        default:
  37   2          break;
  38   2        }
  39   1      }
  40          
  41          void cmd_w12864(uint8 cmd)
  42          {
  43   1        chekbusy12864();
  44   1      
  45   1        RS = 0;
  46   1        RW = 0;
  47   1        _nop_();
  48   1        E = 1;
  49   1        _nop_();
  50   1        P2 = cmd;
  51   1        _nop_();
  52   1        E = 0;
  53   1      }
  54          
C51 COMPILER V9.60.7.0   LCD12864                                                          06/13/2023 09:48:00 PAGE 2   

  55          void dat_w12864(uint8 dat)
  56          {
  57   1        chekbusy12864();
  58   1      
  59   1        RS = 1;
  60   1        RW = 0;
  61   1        _nop_();
  62   1        E = 1;
  63   1        _nop_();
  64   1        P2 = dat;
  65   1        _nop_();
  66   1        E = 0;
  67   1      }
  68          
  69          void clear12864(void)
  70          {
  71   1        uint8 page, row;
  72   1      
  73   1        // 选择左屏
  74   1        choose12864(0);
  75   1        // 遍历 8 页
  76   1        for (page = 0; page < 8; page++)
  77   1        {
  78   2          cmd_w12864(0xb8 + page);
  79   2          cmd_w12864(0x40);
  80   2          for (row = 0; row < 64; row++)
  81   2          {
  82   3      
  83   3            dat_w12864(0x00);
  84   3          }
  85   2        }
  86   1      
  87   1        choose12864(1);
  88   1        for (page = 0; page < 8; page++)
  89   1        {
  90   2          cmd_w12864(0xb8 + page);
  91   2          cmd_w12864(0x40);
  92   2          for (row = 0; row < 64; row++)
  93   2          {
  94   3            dat_w12864(0x00);
  95   3          }
  96   2        }
  97   1      }
  98          
  99          void LCD_init(void)
 100          {
 101   1        chekbusy12864();
 102   1        cmd_w12864(0xc0);
 103   1        cmd_w12864(0x3f);
 104   1        clear12864();
 105   1      }
 106          
 107          void play8(uint8 x, uint8 y, uint8 *addr)
 108          {
 109   1        uint8 i;
 110   1      
 111   1        // x>63，说明 x 在右边，选择右屏
 112   1        if (x > 63)
 113   1        {
 114   2          choose12864(1);
 115   2          x = x - 64;
 116   2        }
C51 COMPILER V9.60.7.0   LCD12864                                                          06/13/2023 09:48:00 PAGE 3   

 117   1        else
 118   1          choose12864(0);
 119   1      
 120   1        // 写入 x,y 位置
 121   1        cmd_w12864(0x40 | x);
 122   1        cmd_w12864(0xb8 | (y++));
 123   1      
 124   1        // 确保 y 第八位为 0
 125   1        if ((y & 0x80) == 0)
 126   1          // 写入 8 个 8 位的 16 进制数据
 127   1          for (i = 0; i < 8; i++)
 128   1            dat_w12864(*addr++);
 129   1        else
 130   1          for (i = 0; i < 8; i++)
 131   1            dat_w12864(0xFF - *addr++);
 132   1      
 133   1        // 写入 x, y + 1
 134   1        cmd_w12864(0x40 | x);
 135   1        cmd_w12864(0xb8 | y);
 136   1      
 137   1        if ((y & 0x80) == 0)
 138   1          for (i = 0; i < 8; i++)
 139   1            dat_w12864(*addr++);
 140   1        else
 141   1          for (i = 0; i < 8; i++)
 142   1            dat_w12864(0xFF - *addr++);
 143   1      }
 144          
 145          void play16(uint8 x, uint8 y, uint8 *addr)
 146          {
 147   1        uint8 i;
 148   1      
 149   1        if (x > 63)
 150   1        {
 151   2          choose12864(1);
 152   2          x = x - 64;
 153   2        }
 154   1        else
 155   1          choose12864(0);
 156   1      
 157   1        cmd_w12864(0x40 | x);
 158   1        cmd_w12864(0xb8 | (y++));
 159   1      
 160   1        if ((y & 0x80) == 0)
 161   1          for (i = 0; i < 16; i++)
 162   1            dat_w12864(*addr++);
 163   1        else
 164   1          for (i = 0; i < 16; i++)
 165   1            dat_w12864(0xFF - *addr++);
 166   1      
 167   1        cmd_w12864(0x40 | x);
 168   1        cmd_w12864(0xb8 | y);
 169   1      
 170   1        if ((y & 0x80) == 0)
 171   1          for (i = 0; i < 16; i++)
 172   1            dat_w12864(*addr++);
 173   1        else
 174   1          for (i = 0; i < 16; i++)
 175   1            dat_w12864(0xFF - *addr++);
 176   1      }
 177          
 178          void drawPicture8(uint8 x, uint8 y, uint8 *addr)
C51 COMPILER V9.60.7.0   LCD12864                                                          06/13/2023 09:48:00 PAGE 4   

 179          {
 180   1        uint8 i;
 181   1      
 182   1        // x>63，说明 x 在右边，选择右屏
 183   1        if (x > 63)
 184   1        {
 185   2          choose12864(1);
 186   2          x = x - 64;
 187   2        }
 188   1        else
 189   1          choose12864(0);
 190   1      
 191   1        // 写入 x,y 位置
 192   1        cmd_w12864(0x40 | x);
 193   1        cmd_w12864(0xb8 | (y++));
 194   1      
 195   1        // 确保 y 第八位为 0
 196   1        if ((y & 0x80) == 0)
 197   1          // 写入 8 个 8 位的 16 进制数据
 198   1          for (i = 0; i < 8; i++)
 199   1            dat_w12864(*addr++);
 200   1        else
 201   1          for (i = 0; i < 8; i++)
 202   1            dat_w12864(0xFF - *addr++);
 203   1      
 204   1        // 写入 x, y + 1
 205   1        cmd_w12864(0x40 | x);
 206   1        cmd_w12864(0xb8 | y);
 207   1      
 208   1        if ((y & 0x80) == 0)
 209   1          for (i = 0; i < 8; i++)
 210   1            dat_w12864(*addr++);
 211   1        else
 212   1          for (i = 0; i < 8; i++)
 213   1            dat_w12864(0xFF - *addr++);
 214   1      }
 215          
 216          void drawPicture16(uint8 x, uint8 y, uint8 *addr, int8 dir_horizon, int8 dir_vertical)
 217          {
 218   1        uint8 i;
 219   1        uint8 crossedScreen = x == 63 ? 1 : 0;
 220   1        uint8 crossingScreen = 0;
 221   1      
 222   1        if (x > 47 && x < 63)
 223   1        {
 224   2          switch (dir_horizon)
 225   2          {
 226   3          case DIR_LEFT:
 227   3            crossingScreen = 1;
 228   3            break;
 229   3          case DIR_RIGHT:
 230   3            crossingScreen = 2;
 231   3            break;
 232   3          default:
 233   3            break;
 234   3          }
 235   2        }
 236   1      
 237   1        if (x > 63)
 238   1        {
 239   2          choose12864(1);
 240   2          x = x - 64;
C51 COMPILER V9.60.7.0   LCD12864                                                          06/13/2023 09:48:00 PAGE 5   

 241   2        }
 242   1        else
 243   1          choose12864(0);
 244   1      
 245   1        cmd_w12864(0x40 | x);
 246   1        cmd_w12864(0xb8 | y);
 247   1      
 248   1        if ((y & 0x80) == 0)
 249   1        {
 250   2          switch (crossingScreen)
 251   2          {
 252   3          case 0:
 253   3            for (i = 0; i < 16; i++)
 254   3              dat_w12864(addr[i]);
 255   3            break;
 256   3          case 1:
 257   3            break;
 258   3          case 2:
 259   3            for (i = 0; i < 63 - x; i++)
 260   3              dat_w12864(addr[i]);
 261   3            break;
 262   3          default:
 263   3            break;
 264   3          }
 265   2        }
 266   1        else
 267   1          for (i = 0; i < 16; i++)
 268   1            dat_w12864(0xFF - addr[i]);
 269   1      
 270   1        // 下半部分
 271   1        cmd_w12864(0x40 | x);
 272   1        cmd_w12864(0xb8 | (y + 1));
 273   1      
 274   1        if ((y & 0x80) == 0)
 275   1        {
 276   2          switch (crossingScreen)
 277   2          {
 278   3          case 0:
 279   3            for (i = 0; i < 16; i++)
 280   3              dat_w12864(addr[i + 16]);
 281   3            break;
 282   3          case 1:
 283   3            break;
 284   3          case 2:
 285   3            for (i = 0; i < 63 - x; i++)
 286   3              dat_w12864(addr[i + 16]);
 287   3            break;
 288   3          default:
 289   3            break;
 290   3          }
 291   2        }
 292   1        else
 293   1          for (i = 0; i < 16; i++)
 294   1            dat_w12864(0xFF - addr[i + 16]);
 295   1      
 296   1        // 横跨左右屏幕
 297   1        if (crossedScreen)
 298   1        {
 299   2          cmd_w12864(0x40 | x);
 300   2          cmd_w12864(0xb8 | y);
 301   2      
 302   2          for (i = 0; i < 16; i++)
C51 COMPILER V9.60.7.0   LCD12864                                                          06/13/2023 09:48:00 PAGE 6   

 303   2            dat_w12864(0x00);
 304   2      
 305   2          cmd_w12864(0x40 | x);
 306   2          cmd_w12864(0xb8 | (y + 1));
 307   2      
 308   2          for (i = 0; i < 16; i++)
 309   2            dat_w12864(0x00);
 310   2        }
 311   1      }
*** WARNING C280 IN LINE 216 OF lcd12864.c: 'dir_vertical': unreferenced local variable
 312          
 313          void clearObject(uint8 x, uint8 y)
 314          {
 315   1        uint8 i;
 316   1      
 317   1        if (x > 63)
 318   1        {
 319   2          choose12864(1);
 320   2          x = x - 64;
 321   2        }
 322   1        else
 323   1          choose12864(0);
 324   1      
 325   1        cmd_w12864(0x40 | x);
 326   1        cmd_w12864(0xb8 | (y++));
 327   1      
 328   1        for (i = 0; i < 16; i++)
 329   1          dat_w12864(0x00);
 330   1      
 331   1        cmd_w12864(0x40 | x);
 332   1        cmd_w12864(0xb8 | y);
 333   1      
 334   1        for (i = 0; i < 16; i++)
 335   1          dat_w12864(0x00);
 336   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1092    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      21
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
